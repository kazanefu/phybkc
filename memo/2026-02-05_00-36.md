# 進捗報告 (2026-02-05 00:36)

## 完了したタスク

### 1. キー名の抽象化 (Key Name Abstraction)
- **概要**: 生のスキャンコード (`0x1E`) の代わりに、人間が読めるキー名 (`A`, `Escape`, `LeftCtrl`) を設定ファイルで使用可能にしました。
- **実装詳細**:
  - `profile` クレートに `key_map` モジュールを追加し、双方向マップ（名前 ↔ スキャンコード）を実装。
  - `Profile` 構造体の読み込み時に名前解決を行うロジックを追加。
  - `daemon` のログ出力を改善し、リマップ時に解決されたキー名を表示するように変更。

### 2. スクリプトエンジン (DSL) - パーサー実装
- **概要**: `.phybkc` スクリプトファイルを解析し、実行可能な AST (抽象構文木) に変換するパーサーを実装しました。
- **実装詳細**:
  - 新規クレート `dsl` を作成 (`crates/dsl`)。
  - **ライブラリ**: `winnow` (v0.7) を採用。
  - **サポート機能** (`design.md` の仕様を網羅):
    - **マクロ**: `macro NAME { ... }` 定義と `NAME!;` 呼び出し。
    - **制御構文**: `if`, `elif`, `else`, `loop`。
    - **高度な実行コマンド**: `TryRun: ... :FailExecute: ...` (例外処理付き実行)。
    - **条件判定**: `wait_input()`, `now_input()`, `wait_released()` (時間指定対応)。
    - **拡張キー**: `#E0/0x...` 形式のサポート。
    - **入力送信**: `Send: String("...") + Code_Key`。
  - **テスト**: 複雑なネストを含むスクリプトやマクロ展開の構文解析テストをパス。

## 次のステップ

### スクリプト実行エンジン (Execution Engine) の実装
- 解析された AST を実際に実行するランタイムの実装に移ります。
- `daemon` への統合を行い、キーフックと連動してスクリプトを発火させる仕組みを構築します。
