# 進捗まとめ (2026-02-04 22:32)

## 完了した内容

### 1. プロファイル管理ライブラリ (`profile`)
- **設定ファイルの読み込み**: `config.toml` (全体設定) と `profile.json` (キーマップ) のパース機能を実装しました。
- **バリデーション**: `anyhow` を使用したエラーハンドリングと、TOML/JSON 正確性の検証用ユニットテストを完了しました。

### 2. キー入力監視・変換エンジン (`daemon`)
- **低レベルフックの統合**: Windows API (`SetWindowsHookExW`) を使用して、物理キーの `ScanCode` をキャプチャする仕組みを構築しました。
- **動的リマッピング**: 読み込んだプロファイルに基づき、入力された `ScanCode` を別の `ScanCode` へと実行時に書き換えるロジックを実装しました。
- **入力エミュレーション**: `SendInput` を用いて、システムに対して変換後のキーイベントを発行する機能を実装しました。
- **再帰防止**: `LLKHF_INJECTED` フラグをチェックすることで、自分自身が発行したキー入力によって無限ループに陥る問題を解決しました。

## 現在の状態
- デーモンを起動すると `config.toml` を読み込み、指定されたプロファイルに基づいてキーのリマッピングが有効になります。
- ユーザーによるテストにより、`0x02` → `0x1E` 等の物理キー変換が意図通りに動作することを確認済みです。

## 次の課題
1. **キー定義の抽象化**: `0x1E` などの 16 進数表記ではなく、`Code_A` や `Escape` などの名前で設定できるようにします。
2. **スクリプトエンジン (DSL) の実装**: `.phybkc` 形式のスクリプトを解析し、`Run` や `Wait` などの複雑なアクションを実行できるようにします。
3. **GUI / タスクトレイの実装**: プロファイルの切り替えや設定を容易にするためのインターフェースを作成します。
