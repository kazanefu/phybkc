# 不足している設計情報概要 (更新済み)

`design.md` の更新により、主要な技術的決定がなされました。

## 1. 物理キーの識別方法 (Physical Key Mapping) - [解決]
- **決定**: `ScanCode` を使用する。

## 2. プロファイル設定ファイルのスキーマ - [解決]
- **決定**: 
    - 全体設定: TOML
    - 各プロファイル: JSON
    - 具体的なフィールド（name, scripts, keys）も定義済み。

## 3. スクリプトエンジンの仕様 - [解決]
- **決定**: 
    - 独自拡張子 `.phybkc`。
    - キーワード（Run, Execute, wait_input 等）と構文案が提供された。

## 4. デーモンと GUI/CLI 間の通信 (IPC) - [解決]
- **決定**: 基本的に通信は行わず、設定更新時にデーモンを再起動する。

## 5. OS フックの具体的な実装方針 - [解決]
- **決定**: `SetWindowsHookEx` (WH_KEYBOARD_LL) を使用する。

## 6. キーボードレイアウトの考慮 - [解決]
- **決定**: プロファイル編集画面（GUI）でレイアウトを選択できるようにする。

## 7. タスクトレイ UI の詳細 - [解決]
- **決定**: メニュー項目（切り替え、GUI起動、Stop, Exit, Restart）が定義された。

---
## 実装時に検討が必要な細部
- **ScanCode の差異**: キーボード（JIS/US等）による ScanCode の違いを録画(Record)機能等でどう吸収するか。
- **スクリプトの同時実行**: 複数のスクリプトが重なった場合の優先順位や排他制御。
- **例外処理**: `Run` で指定したコマンドが失敗した場合の挙動。

これらは実装を進めながら詳細を固めていくことが可能です。
